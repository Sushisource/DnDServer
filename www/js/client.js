// Generated by CoffeeScript 1.3.1
(function() {
  var $j, dispatch, echo, init_websocket;

  $j = jQuery;

  $j.dnd = {};

  $j.dnd.callbacks = {};

  dispatch = function(protocol, data) {
    var func;
    func = $j.dnd.callbacks[protocol];
    if (typeof func === 'undefined') {
      console.log("Undefined callback '" + protocol + "'");
      return;
    }
    return func(data);
  };

  echo = function(message) {
    return console.log(message);
  };

  init_websocket = function() {
    window.ws = new WebSocket("ws://192.168.1.10:9000/ws");
    window.ws.onopen = function(e) {
      console.log("Connected");
      $j(".brand").css('color', 'white');
      return window.ws.send("get_state()");
    };
    window.ws.onmessage = function(e) {
      var dat, data, protocol;
      dat = JSON.parse(e.data);
      protocol = dat[0];
      data = dat[1];
      console.log("-" + protocol + "- \n");
      return dispatch(protocol, data);
    };
    window.ws.onclose = function(e) {
      console.log("Lost connection");
      $j(".brand").css('color', 'red');
      return init_websocket();
    };
    return window.ws.onerror = function(e) {
      return console.log("Error: " + e.message);
    };
  };

  $j(function() {
    init_websocket();
    return $j.dnd.callbacks['echo'] = echo;
  });

}).call(this);
